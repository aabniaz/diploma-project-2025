import numpy as np
import matplotlib.pyplot as plt

data = {
    "Aral":      [1.2088235294117649, 1.56, 0.6235294117647059, 0.351219512195122, 1.1405405405405407, 1.378787878787879, 1.4875, 0.4173913043478262, 0.9700000000000001, 0.9829787234042554, 1.2027027027027026, 1.0513513513513513, 1.0272727272727273, 1.26875, 0.7054054054054054, 1.1545454545454545, 0.35, 1.1, 1.2666666666666668, 1.5812500000000003],  
    "Zhosaly":           [1.1466666666666667, 1.3851851851851853, 0.6272727272727272, 1.9407407407407409, 1.0153846153846153, 1.2846153846153845, 1.1916666666666667, 0.4222222222222222, 1.484, 1.3311111111111111, 1.155263157894737, 1.3311111111111111, 0.7937500000000001, 1.4289473684210527, 1.061904761904762, 1.7390243902439024, 0.8333333333333334, 1.1634146341463416, 1.6285714285714286, 0.9700000000000001],
    "Zliha":            [1.0481481481481483, 1.452173913043478, 0.49090909090909096, 0.6407407407407407, 1.2846153846153845, 1.3133333333333332, 1.2666666666666666, 0.7542857142857142, 0.875, 2.5783783783783787, 1.1210526315789473, 2.4655172413793105, 1.6933333333333331, 1.5391304347826087, 2.673076923076923, 2.5903225806451613, 2.0363636363636366, 1.1458333333333333, 2.411764705882353, 1.3058823529411765],
    "Kazaly":           [2.0535714285714284, 1.2956521739130435, 1.0799999999999998, 0.7639999999999999, 1.78, 2.107407407407407, 1.2333333333333334, 1.018181818181818, 1.9263157894736842, 1.7269230769230772, 1.8772727272727272, 1.7515151515151515, 1.3599999999999999, 2.1608695652173915, 2.011764705882353, 1.5733333333333335, 0.5266666666666666, 1.6857142857142857, 2.3111111111111113, 1.782142857142857],
    "Karak":            [1.8624999999999998, 3.6666666666666665, 1.781818181818182, 1.9454545454545455, 0.9785714285714285, 1.85, 1.6166666666666665, 1.2571428571428573, 1.1615384615384614, 1.4375, 1.1615384615384614, 2.575, 1.3800000000000001, 3.4, 0.8, 1.7583333333333335, 0.8250000000000001, 1.375, 1.7909090909090908, 0.7749999999999999],
    "Kulandy":           [1.8055555555555556, 1.9642857142857142, 1.088, 0.8722222222222222, 1.2125000000000001, 0.9121212121212121, 1.1277777777777778, 0.47368421052631576, 1.2823529411764707, 1.1923076923076923, 1.5578947368421054, 0.9689655172413794, 0.90625, 1.108695652173913, 1.568421052631579, 0.8692307692307693, 0.2722222222222222, 1.2478260869565219, 1.0959999999999999, 1.2125],
    "Kyzylorda":          [0.8717391304347827, 1.2485714285714287, 0.47750000000000004, 0.8971428571428572, 0.8340909090909091, 1.1225, 1.2730769230769232, 0.8860465116279068, 1.9303030303030304, 1.876, 0.6707317073170732, 1.9384615384615382, 1.3863636363636365, 1.4475000000000002, 1.3807692307692307, 1.5833333333333333, 0.8071428571428573, 0.8816326530612244, 1.603225806451613, 0.9156249999999999],  
    "Shiely":            [1.8642857142857143, 3.123529411764706, 1.48, 1.3956521739130436, 1.5999999999999999, 2.659090909090909, 1.8199999999999998, 1.9000000000000001, 2.5, 3.444, 1.4875, 2.0115384615384615, 1.8952380952380952, 1.5315789473684212, 2.9923076923076923, 2.348648648648649, 2.3857142857142857, 2.295833333333333, 2.1578947368421053, 1.6840000000000002]   
}

years = np.arange(2005, 2025)

def snht(x):
    n = len(x)
    mean_total = np.mean(x)
    H = []
    for i in range(1, n-1):
        mean1 = np.mean(x[:i])
        mean2 = np.mean(x[i:])
        T_i = (i * (mean1 - mean_total) ** 2 + (n - i) * (mean2 - mean_total) ** 2)
        H.append(T_i)
    return np.array(H)

fig, axs = plt.subplots(2, 4, figsize=(12, 8))
axs = axs.flatten()

for idx, (station, temps) in enumerate(data.items()):
    temps = np.array(temps)
    H = snht(temps)
    H_max = np.max(H)
    cp_idx = np.argmax(H)
    cp_year = years[1:-1][cp_idx]

    print(f" {station}")
    print(f"  Razryv year: {cp_year}")
    print(f"  H_max: {H_max:.2f}")
    print(f"  Average before {cp_year}: {np.mean(temps[:cp_idx+1]):.2f}")
    print(f"  Average after {cp_year}: {np.mean(temps[cp_idx+1:]):.2f}")
    print(f"  Razryv between values: {temps[cp_idx]:.2f} â†’ {temps[cp_idx+1]:.2f}\n")


    axs[idx].plot(years[1:-1], H, marker='o')
    axs[idx].axvline(cp_year, color='red', linestyle='--', label=f'Razryv: {cp_year}')
    axs[idx].set_title(f"{station}\nH_max = {H_max:.2f}")
    axs[idx].set_xlabel("Year")
    axs[idx].set_ylabel("SNHT Stat")
    axs[idx].legend()

plt.tight_layout()
plt.savefig('soil_snht')
plt.show()
