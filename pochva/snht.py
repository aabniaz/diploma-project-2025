import numpy as np
import matplotlib.pyplot as plt

data = {
    "Aral":      [-10.84444444, -9.8, -5.022222222, -15.18681319, -9.5, -11.5, -9.422222222, -14.35164835, -9.011111111, -11.07777778, -8.144444444, -1.879120879, -8.355555556, -11.43333333, -8.688888889, -4.197802198, -10.7, -6.177777778, -8.288888889, -7.21978022],  
    "Zhosaly":           [-8.177777778, -9.333333333, -4.744444444, -13.40659341, -5.855555556, -7.266666667, -8.911111111, -13.32967033, -7.455555556, -11.06666667, -5.766666667, -0.945054945, -7.833333333, -10.34444444, -6.388888889, -3.681318681, -9.622222222, -3.277777778, -6.988888889, -4.791208791],
    "Zliha":            [-7.544444444, -7.844444444, -4.533333333, -11.50549451, -1.866666667, -5.577777778, -7.055555556, -12.82417582, -7.288888889, -11.58888889, -4.888888889, -0.417582418, -5.233333333, -6.177777778, -4.844444444, -2.230769231, -10.54444444, -1.8, -6.977777778, -4.0769230772],
    "Kazaly":           [-7.944444444, -7.277777778, -3.644444444, -11.84615385, -7.266666667, -8.044444444, -7.577777778, -11.45054945, -7.4, -9.4, -6.166666667, -0.901098901, -7.422222222, -9.633333333, -6.088888889, -2.296703297, -7.3, -3.188888889, -6.733333333, -4.648351648],
    "Karak":            [-6.622222222, -8.911111111, -3.233333333, -11.93406593, -5.144444444, -5.766666667, -8.055555556, -10.37362637, -6.555555556, -10.1, -4.244444444, -0.054945055, -5.955555556, -9.077777778, -4.466666667, -1.868131868, -7.5, -2.322222222, -6.122222222, -3.747252747],
    "Kulandy":           [-9.611111111, -9.455555556, -3.733333333, -13.85714286, -9.622222222, -11.12222222, -9.666666667, -13.41758242, -7.955555556, -9.866666667, -7.277777778, -1.615384615, -7.7, -10.88888889, -7.811111111, -2.56043956, -8.6, -6.066666667, -8.011111111, -6.142857143],
    "Kyzylorda":          [-6.5, -6.411111111, -3.577777778, -10.53846154, -3.744444444, -5.6, -6.255555556, -11.06593407, -6.255555556, -9.055555556, -3.666666667, 0.032967033, -4.888888889, -6.333333333, -4.122222222, -1.494505495, -7.988888889, -0.944444444, -5.866666667, -3.527472527],  
    "Shiely":            [-4.711111111, -4.755555556, -3.077777778, -8.549450549, -0.911111111, -3.177777778, -4.2, -7.835164835, -3.477777778, -6.222222222, -1.333333333, 1.736263736, -2.488888889, -3.277777778, -0.833333333, -0.010989011, -5.033333333, -0.255555556, -3.833333333, -2.241758242]   
}

years = np.arange(2005, 2025)

def snht(x):
    n = len(x)
    mean_total = np.mean(x)
    T = []
    for i in range(1, n-1):
        mean1 = np.mean(x[:i])
        mean2 = np.mean(x[i:])
        T_i = (i * (mean1 - mean_total) ** 2 + (n - i) * (mean2 - mean_total) ** 2)
        T.append(T_i)
    return np.array(T)

fig, axs = plt.subplots(2, 4, figsize=(12, 8))
axs = axs.flatten()

for idx, (station, temps) in enumerate(data.items()):
    temps = np.array(temps)
    T = snht(temps)
    T_max = np.max(T)
    cp_idx = np.argmax(T)
    cp_year = years[1:-1][cp_idx]

    print(f" {station}")
    print(f"  Razryv year: {cp_year}")
    print(f"  T_max: {T_max:.2f}")
    print(f"  Average before {cp_year}: {np.mean(temps[:cp_idx+1]):.2f}")
    print(f"  Average after {cp_year}: {np.mean(temps[cp_idx+1:]):.2f}")
    print(f"  Razryv between values: {temps[cp_idx]:.2f} â†’ {temps[cp_idx+1]:.2f}\n")


    axs[idx].plot(years[1:-1], T, marker='o')
    axs[idx].axvline(cp_year, color='red', linestyle='--', label=f'Razryv: {cp_year}')
    axs[idx].set_title(f"{station}\nT_max = {T_max:.2f}")
    axs[idx].set_xlabel("Year")
    axs[idx].set_ylabel("SNHT Stat")
    axs[idx].legend()

plt.tight_layout()
plt.savefig('soil_snht')
plt.show()

