import numpy as np
import matplotlib.pyplot as plt

data = {
    "Aral":      [-10.90111111,	-10.15555556,	-5.123333333,	-15.1956044,	-9.852222222,	-12.23111111,	-3.164444444,	-14.87802198,	-9.222222222,	-11.39222222,	-8.176666667,	-2.486813187,	-8.828888889,	-12.12222222,	-8.83,         	-4.297802198,	-10.56222222,	-6.147777778,	-8.414444444,	-6.976923077],  
    "Zhosaly":           [-8.078888889,	-9.154444444,	-4.824444444,	-13.58461538,	-6.023333333,	-7.342222222,	-8.772222222,	-13.08131868,	-7.6,       	-10.90444444,	-5.68,      	-1.089010989,	-7.855555556,	-10.19444444,	-6.306666667,	-3.207692308,	-9.74,      	-3.015555556,	-7.452222222,	-4.813186813], 
    "Zliha":            [-7.755555556,	-7.97,	        -4.365555556,	-11.74285714,   -1.802222222,	-5.678888889,	-7.731111111,	-13.21978022,	-7.538888889,	-11.43777778,	-5.008888889,	-0.689010989,	-5.923333333,	-7.735555556,	-5.283333333,	-2.276923077,	-10.14888889,	-1.921111111,	-7.287777778,	-4.402197802],
    "Kazaly":           [-8.227777778,	-8.322222222,	-4.221111111,	-12.93846154,	-7.797777778,	-9.201111111,	-8.671111111,	-12.89230769,	-7.888888889,	-10.25222222,	-6.563333333,	-1.182417582,	-7.615555556,	-10.22444444,	-6.726666667,	-2.945054945,	-8.735555556,	-3.854444444,	-7.218888889,	-4.967032967],  
    "Karak":            [-7.121111111,	-8.852222222,	-3.656666667,	-12.01538462,	-5.37,	        -6.371111111,	-7.797777778,	-10.7032967,   	-6.451111111,	-9.912222222,	-4.521111111,	-0.069230769,	-5.748888889,	-8.911111111,	-4.662222222,	-1.7,       	-7.625555556,	-2.117777778,	-6.188888889,	-3.959340659],  
    "Kulandy":           [-6.478888889,	-6.652222222,	-3.35,	        -10.31538462,	-3.64,	        -5.702222222,	-6.518888889,	-11.53626374,	-5.976666667,	-9.347777778,	-3.582222222,	0.452747253,	-4.597777778,	-6.583333333,	-4.012222222,	-0.745054945,	-7.512222222,	-0.864444444,	-5.262222222,	-2.938461538],  
    "Kyzylorda":          [-9.684444444,	-9.846666667,	-3.872222222,	-13.64285714,	-9.312222222,	-11.19111111,	-9.283333333,	-13.1956044,	-7.91,      	-9.94,      	-7.107777778,	-1.743956044,	-7.631111111,	-10.70777778,	-7.45,      	-2.554945055,	-8.901111111,	-5.89,	        -7.7,	        -5.756043956],  
    "Shiely":        [-4.441111111,	-4.48,	        -2.9,	        -8.258241758,	-0.894444444,	-2.962222222,	-3.658888889,	-7.648351648,	-3.785555556,	-6.642222222,	-1.361111111,	2.007692308,	-2.245555556,	-3.733333333,	-0.918888889,	0.283516484,   	-4.626666667,	0.28,       	-3.321111111,	-1.571712159]   
}

years = np.arange(2005, 2025)

def snht(x):
    n = len(x)
    mean_total = np.mean(x)
    T = []
    for i in range(1, n-1):
        mean1 = np.mean(x[:i])
        mean2 = np.mean(x[i:])
        T_i = (i * (mean1 - mean_total) ** 2 + (n - i) * (mean2 - mean_total) ** 2)
        T.append(T_i)
    return np.array(T)

fig, axs = plt.subplots(2, 4, figsize=(12, 8))
axs = axs.flatten()

for idx, (station, temps) in enumerate(data.items()):
    temps = np.array(temps)
    T = snht(temps)
    T_max = np.max(T)
    cp_idx = np.argmax(T)
    cp_year = years[1:-1][cp_idx]

    print(f" {station}")
    print(f"  Razryv year: {cp_year}")
    print(f"  T_max: {T_max:.2f}")
    print(f"  Aver bef {cp_year}: {np.mean(temps[:cp_idx+1]):.2f}")
    print(f"  Aver aft {cp_year}: {np.mean(temps[cp_idx+1:]):.2f}")
    print(f"  Razryv between values: {temps[cp_idx]:.2f} â†’ {temps[cp_idx+1]:.2f}\n")


    axs[idx].plot(years[1:-1], T, marker='o')
    axs[idx].axvline(cp_year, color='red', linestyle='--', label=f'Razryv: {cp_year}')
    axs[idx].set_title(f"{station}\nT_max = {T_max:.2f}")
    axs[idx].set_xlabel("Year")
    axs[idx].set_ylabel("SNHT Stat")
    axs[idx].legend()


plt.tight_layout()
plt.savefig('soil_snht')
plt.show()

