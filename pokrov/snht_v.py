import numpy as np
import matplotlib.pyplot as plt

data = {
    "Aral": [12.18390805, 4.333333333,	3.544444444,	16.2967033,	14.75324675,	7.052631579,	7.268292683,	9.604395604,	3.85483871,	8.365853659,	3.093333333,	1.5,	7.641025641,	10.76666667,	3.457831325,	6.256756757,	1.189189189,	5.375,	2.272727273,	3.813559322],  # 20 значений
    "Zhosaly": [2.794520548, 3.18, 3.758064516, 6.424657534, 3.078431373, 1.142857143, 6.972972973, 2.395604396, 4.8, 12.1625, 2.327586207, 1.333333333, 8.44, 7.155555556, 6, 3.455882353, 2.675324675, 2.053333333, 3.432432432, 3.111111111],
    "Zliha": [3.391304348, 4.833333333, 3.785714286, 5.7, 6.4, 3.511627907, 1.21875, 4.563218391, 3.256410256, 24.45333333, 3.280701754, 1.542857143, 6.975, 0.968253968, 8.390243902, 4.220338983, 3.632183908, 1.777777778, 1.88, 3.2],
    "Kazaly": [5.355932203, 2.282051282, 4.169230769, 5.712328767, 10.41558442, 3.786666667, 3.348837209, 3.934065934, 4.454545455, 7.375, 2.402777778, 1.434782609, 9.415584416, 10.76666667, 6.311111111, 3.609375, 1.194444444, 3.245283019, 4.03125, 4.552631579],
    "Karak": [2.411764706, 5.522727273, 2.044444444, 2.863636364, 3.254545455, 1.96875, 3.407407407, 1.739130435, 3.432432432, 4.2, 1.074074074, 2.714285714, 3.873239437, 4.433333333, 3.025641026, 3.680851064, 2.4, 2.111111111, 1.142857143, 3.588235294],
    "Kulandy": [23.11538462, 4.030289044, 3.818181818, 16.05494505, 28.72972973, 17.5890411, 14.4, 10.6043956, 13.29577465, 17.2027027, 2.426470588, 3.526315789, 13.59756098, 19.25609756, 9.333333333, 3.066666667, 0.730769231, 9.971428571, 1.780487805, 3.302325581],
    "Kyzylorda": [1.98245614, 6.738095238, 2.132075472, 4.421875, 3.693877551, 1.744680851, 1.935483871, 4.282352941, 5, 8.567901235, 2.022727273, 2.384615385, 5.426666667, 1.682926829, 8.239130435, 3.216666667, 2.304347826, 1.228571429, 0.694444444, 6.210526316],
    "Shiely": [3.979166667, 9.953488372, 2.209302326, 3.107692308, 3.266666667, 3.1875, 1.357142857, 4.333333333, 4.857142857, 4.294871795, 1.782608696, 2.882352941, 1.93877551, 1.565217391, 1.2, 1.785714286, 4.033333333, 3.379310345, 1.125, 3.702702703],
}

years = np.arange(2005, 2025)

def snht(x):
    n = len(x)
    mean_total = np.mean(x)
    T = []
    for i in range(1, n-1):
        mean1 = np.mean(x[:i])
        mean2 = np.mean(x[i:])
        T_i = (i * (mean1 - mean_total) ** 2 + (n - i) * (mean2 - mean_total) ** 2)
        T.append(T_i)
    return np.array(T)

fig, axs = plt.subplots(2, 4, figsize=(12, 8))
axs = axs.flatten()

for idx, (station, temps) in enumerate(data.items()):
    temps = np.array(temps)
    T = snht(temps)
    H_max = np.max(T)
    cp_idx = np.argmax(T)
    cp_year = years[1:-1][cp_idx]

    print(f" {station}")
    print(f"  Razryv year: {cp_year}")
    print(f"  H_max: {H_max:.2f}")
    print(f"  Aver bef {cp_year}: {np.mean(temps[:cp_idx+1]):.2f}")
    print(f"  Aver aft {cp_year}: {np.mean(temps[cp_idx+1:]):.2f}")
    print(f"  Razryv between values: {temps[cp_idx]:.2f} → {temps[cp_idx+1]:.2f}\n")


    axs[idx].plot(years[1:-1], T, marker='o')
    axs[idx].axvline(cp_year, color='red', linestyle='--', label=f'Razryv: {cp_year}')
    axs[idx].set_title(f"{station}\H_max = {H_max:.2f}")
    axs[idx].set_xlabel("Year")
    axs[idx].set_ylabel("SNHT Stat")
    axs[idx].legend()

plt.tight_layout()
plt.savefig('snow_snht')

plt.show()

